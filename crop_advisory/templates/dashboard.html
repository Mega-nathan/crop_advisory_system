<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Smart Crop Advisory Dashboard</title>
    <!-- Google Material Icons -->
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Jost:ital,wght@0,100..900;1,100..900&family=Outfit:wght@100..900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Quicksand:wght@300..700&display=swap"
      rel="stylesheet"
    />
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
      /* ================== RESET & BODY ================== */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Poppins", sans-serif;
      }

      body {
        height: 100vh;
        background: #ebf2f8;
        color: #333;
        display: flex;
        flex-direction: column;
      }

      /* ================== HEADER ================== */
      header nav {
        background: #fdfdfd;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 15px 20px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      }

      .logo a {
        text-decoration: none;
        font-weight: bold;
        font-size: 20px;
        color: #2b7a3d;
      }

      /* ================== LAYOUT ================== */
      .layout {
        flex: 1;
        display: flex;
        height: calc(100vh - 60px); /* remove header height */
      }

      /* ================== SIDEBAR ================== */
      .sidebar {
        width: 240px;
        height: 120vh;
        background: #dbe4e9;
        box-shadow: 2px 0 5px rgba(0, 0, 0, 0.05);
        padding: 20px 0;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
      }

      .sidebar-nav {
        list-style: none;
        margin-top: 20px;
      }

      .sidebar-nav li {
        margin: 10px 0;
      }

      .sidebar-nav a {
        text-decoration: none;
        color: #373f4c;
        padding: 12px 20px;
        display: flex;
        align-items: center;
        border-radius: 6px;
        transition: all 0.1s;
        gap: 10px;
      }

      .sidebar-nav a:hover {
        background: #2472cc;
        color: #fff;
      }

      .sidebar-nav a.active {
        background: #2472cc;
        color: #fff;
      }

      /* ================== MAIN CONTENT ================== */
      .main-content {
        margin-left: 50px;
        padding: 36px 40px;
        min-height: 100vh;
        background: transparent;
        flex: 1;
      }

      .dashboard-header {
        font-size: 2em;
        font-weight: bold;
        margin-bottom: 32px;
        letter-spacing: -1.5px;
      }

      /* ================== SECTION STYLES ================== */
      .section {
        background: #fff;
        border-radius: 16px;
        box-shadow: 0 0 10px #e4edfa26;
        flex: 1 1 370px;
        padding: 26px;
        margin-bottom: 30px;
        min-width: 320px;
        max-width: 500px;
      }

      .section-title {
        font-size: 1.15em;
        font-weight: bold;
        margin-bottom: 16px;
        color: #1b242b;
      }

      /* ================== FILTER BUTTONS ================== */
      .filter-buttons {
        margin-bottom: 15px;
        display: flex;
        gap: 15px;
        justify-content: center;
      }

      .filter-btn {
        background: #e8eaf6;
        border: none;
        border-radius: 24px;
        padding: 8px 24px;
        color: #222;
        font-weight: 600;
        cursor: pointer;
        transition: background-color 0.25s ease;
        user-select: none;
        font-size: 0.95em;
      }

      .filter-btn.active {
        background-color: #2254f4;
        color: white;
      }

      /* ================== LEGEND ================== */
      .legend-container {
        margin-top: 4px;
        display: flex;
        gap: 24px;
        font-weight: 600;
        font-size: 14px;
        color: #444;
        justify-content: center;
      }

      .legend-item {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .legend-color {
        width: 20px;
        height: 8px;
        border-radius: 3px;
        display: inline-block;
      }

      .legend-wheat {
        background-color: #ffd466;
      }
      .legend-cotton {
        background-color: #97c4fb;
      }

      /* ================== CROP CALENDAR ================== */
      .crop-calendar table {
        width: 100%;
        border-collapse: collapse;
        font-weight: 600;
        user-select: none;
      }

      .crop-calendar th,
      .crop-calendar td {
        border: 1px solid #ddd;
        padding: 9px 12px;
        text-align: center;
        font-weight: 600;
      }

      .crop-calendar th {
        background-color: #f0f5ff;
        color: #1b242b;
        position: sticky;
        top: 0;
        z-index: 10;
      }
      .current-month {
        background-color: #dceeff;
      }

      .sowing,
      .irrigation,
      .harvesting {
        border-radius: 50%;
        width: 20px;
        height: 20px;
        margin: 0 auto;
        cursor: help;
        position: relative;
      }

      .sowing {
        background-color: #ffecb3;
      }
      .irrigation {
        background-color: #bbdefb;
      }
      .harvesting {
        background-color: #c8e6c9;
      }

      .sowing::after,
      .irrigation::after,
      .harvesting::after {
        content: attr(title);
        position: absolute;
        bottom: 125%;
        left: 50%;
        transform: translateX(-50%);
        background-color: rgba(0, 0, 0, 0.75);
        color: #fff;
        padding: 4px 8px;
        border-radius: 4px;
        white-space: nowrap;
        font-size: 0.75em;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.15s ease-in-out;
        z-index: 50;
      }

      .sowing:hover::after,
      .irrigation:hover::after,
      .harvesting:hover::after {
        opacity: 1;
      }

      .season-legend {
        margin-top: 16px;
        display: flex;
        gap: 36px;
        font-weight: 700;
        color: #2c3e50;
        justify-content: center;
      }

      .season-legend span {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 1em;
      }

      .legend-dot {
        width: 20px;
        height: 20px;
        border-radius: 50%;
      }
      .legend-dot.sowing {
        background-color: #ffecb3;
      }
      .legend-dot.irrigation {
        background-color: #bbdefb;
      }
      .legend-dot.harvesting {
        background-color: #c8e6c9;
      }

      /* ================== WEATHER & FARMING ================== */
      .weather-farming-container {
        max-width: 70%;
        margin: 0 auto;
        display: flex;
        gap: 24px;
        justify-content: center;
        flex-wrap: wrap;
        max-height: 380px;
        padding-right: 8px;
        background: #f5faff;
        border-radius: 12px;
        box-shadow: 0 2px 6px rgb(34 84 244 / 0.12);
        overflow: hidden;
      }

      .weather-summary {
        display: flex;
        align-items: center;
        gap: 14px;
        padding: 14px 20px;
        border-radius: 12px;
        background: #e9f2ff;
        box-shadow: 0 2px 8px rgba(34, 84, 244, 0.15);
        min-width: 250px;
        flex-shrink: 0;
        height: 100%;
      }

      .weather-icon {
        font-size: 48px;
        color: #1e3c72;
      }
      .weather-info {
        display: flex;
        flex-direction: column;
        gap: 6px;
        font-weight: 600;
        color: #1565c0;
      }
      .weather-info #temperature {
        font-size: 1.25em;
        font-weight: 700;
      }
      .weather-info #soilMoisture {
        font-size: 0.95em;
        color: #3074bb;
        font-weight: 600;
      }

      .farming-tips {
        max-width: 330px;
        max-height: 340px;
        overflow-y: auto;
        padding-left: 20px;
        font-size: 0.95em;
        color: #415365;
        font-weight: 500;
        line-height: 1.4;
        scroll-behavior: smooth;
      }

      .farming-tips ul {
        list-style-position: inside;
        padding-left: 0;
        margin: 0;
      }
      .farming-tips li {
        margin-bottom: 7px;
        list-style-type: disc;
      }

      .farming-tips::-webkit-scrollbar {
        width: 8px;
        background: #e6f0ff;
        border-radius: 10px;
      }
      .farming-tips::-webkit-scrollbar-thumb {
        background: #4291ff;
        border-radius: 10px;
      }

      /* RESPONSIVE */
      @media (max-width: 900px) {
        .weather-farming-container,
        .weather-summary,
        .farming-tips {
          flex-direction: column;
          align-items: center;
          max-width: 100%;
          max-height: none;
          overflow: visible;
          margin-bottom: 14px;
        }
        .crop-calendar {
          overflow-x: scroll;
        }
      }
    </style>
  </head>
  <body>
    <!-- HEADER -->
    <header>
      <nav>
        <div class="logo"><a href="#">AgriNav</a></div>
      </nav>
    </header>

    <!-- LAYOUT: SIDEBAR + MAIN -->
    <div class="layout">
      <!-- SIDEBAR -->
      <aside class="sidebar">
        <ul class="sidebar-nav">
          <li>
            <a href="http://localhost:8000"
              ><span class="material-symbols-outlined">dashboard</span
              >Dashboard</a
            >
          </li>
          <li>
            <a href="http://localhost:8000/chatbot"
              ><span class="material-symbols-outlined">smart_toy</span
              >Chatbot</a
            >
          </li>
          <li>
            <a href="http://localhost:8000/marketPrice"
              ><span class="material-symbols-outlined">shopping_cart</span
              >Market Price</a
            >
          </li>
          <li>
            <a href="http://localhost:8000/pest"
              ><span class="material-symbols-outlined">pest_control</span>Pest
              Detection</a
            >
          </li>
          <li>
            <a href="http://localhost:8000/weather"
              ><span class="material-symbols-outlined">groups</span>Weather</a
            >
          </li>
          <li>
            <a href="http://localhost:8000/articles"
              ><span class="material-symbols-outlined">article</span>Articles</a
            >
          </li>
          <li>
            <a href="http://localhost:8000/complaint"
              ><span class="material-symbols-outlined">Bookmark_Flag</span
              >Complaint Box</a
            >
          </li>
        </ul>
      </aside>

      <!-- MAIN CONTENT -->
      <main class="main-content">
        <div class="dashboard-header">Dashboard</div>

        <!-- FLEX WRAPPER FOR COMMODITY + WEATHER -->
        <div style="display: flex; gap: 24px; flex-wrap: wrap">
          <!-- Commodity Price Section -->
          <section class="section">
            <div class="section-title">
              Commodity Price Trends (Wheat & Cotton)
            </div>
            <div class="filter-buttons">
              <button class="filter-btn active" data-range="6m">
                Last 6 Months
              </button>
              <button class="filter-btn" data-range="1y">Last Year</button>
              <button class="filter-btn" data-range="3y">3 Years</button>
            </div>
            <div class="chart-area">
              <canvas id="priceChart"></canvas>
            </div>
            <div class="legend-container">
              <div class="legend-item">
                <span class="legend-color legend-wheat"></span> Wheat Price
                (INR/Quintal)
              </div>
              <div class="legend-item">
                <span class="legend-color legend-cotton"></span> Cotton Price
                (INR/Quintal)
              </div>
            </div>
          </section>

          <!-- Weather & Farming Tips Section -->
          <section class="section">
            <div class="section-title">Weather & Farming Tips</div>
            <div class="weather-farming-container">
              <div class="weather-summary">
                <span class="material-icons weather-icon" id="weatherIcon"
                  >wb_sunny</span
                >
                <div class="weather-info">
                  <span id="weatherCondition">Loading weather...</span>
                  <span id="temperature"></span>
                  <span id="location"></span>
                  <span id="soilMoisture"></span>
                </div>
              </div>
              <div class="farming-tips">
                <strong>Farming Tips:</strong>
                <ul id="farmingTips"></ul>
              </div>
            </div>
          </section>
        </div>

        <!-- Crop Calendar Section -->
        <section class="crop-calendar">
          <div class="section-title">Crop Calendar</div>
          <table>
            <thead>
              <tr>
                <th>Crop</th>
                <th class="current-month">Oct</th>
                <th>Nov</th>
                <th>Dec</th>
                <th>Jan</th>
                <th>Feb</th>
                <th>Mar</th>
                <th>Apr</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Wheat</td>
                <td><div class="sowing" title="Sowing"></div></td>
                <td><div class="sowing" title="Sowing"></div></td>
                <td><div class="irrigation" title="Irrigation"></div></td>
                <td><div class="irrigation" title="Irrigation"></div></td>
                <td><div class="irrigation" title="Irrigation"></div></td>
                <td><div class="irrigation" title="Irrigation"></div></td>
                <td><div class="harvesting" title="Harvesting"></div></td>
              </tr>
              <tr>
                <td>Cotton</td>
                <td></td>
                <td></td>
                <td><div class="sowing" title="Sowing"></div></td>
                <td><div class="sowing" title="Sowing"></div></td>
                <td><div class="irrigation" title="Irrigation"></div></td>
                <td><div class="irrigation" title="Irrigation"></div></td>
                <td><div class="harvesting" title="Harvesting"></div></td>
              </tr>
            </tbody>
          </table>
          <div class="season-legend">
            <span
              ><div class="legend-dot sowing"></div>
              Sowing</span
            >
            <span
              ><div class="legend-dot irrigation"></div>
              Irrigation</span
            >
            <span
              ><div class="legend-dot harvesting"></div>
              Harvesting</span
            >
          </div>
        </section>
      </main>
    </div>

    <script>
      // Commodity Price Chart Logic

      const commodityData = {
        "6m": {
          labels: ["Apr", "May", "Jun", "Jul", "Aug", "Sep"],
          wheat: [6500, 6700, 6800, 6900, 7000, 7100],
          cotton: [7100, 7200, 7150, 7300, 7350, 7500],
        },
        "1y": {
          labels: [
            "Oct",
            "Nov",
            "Dec",
            "Jan",
            "Feb",
            "Mar",
            "Apr",
            "May",
            "Jun",
            "Jul",
            "Aug",
            "Sep",
          ],
          wheat: [
            6200, 6250, 6300, 6400, 6500, 6600, 6700, 6800, 6850, 6900, 7000,
            7100,
          ],
          cotton: [
            7000, 7050, 7100, 7150, 7200, 7250, 7300, 7350, 7375, 7400, 7450,
            7500,
          ],
        },
        "3y": {
          labels: [
            "Oct '22",
            "Nov '22",
            "Dec '22",
            "Jan '23",
            "Feb '23",
            "Mar '23",
            "Apr '23",
            "May '23",
            "Jun '23",
            "Jul '23",
            "Aug '23",
            "Sep '23",
            "Oct '23",
            "Nov '23",
            "Dec '23",
            "Jan '24",
            "Feb '24",
            "Mar '24",
            "Apr '24",
            "May '24",
            "Jun '24",
            "Jul '24",
            "Aug '24",
            "Sep '24",
            "Oct '24",
            "Nov '24",
            "Dec '24",
            "Jan '25",
            "Feb '25",
            "Mar '25",
            "Apr '25",
            "May '25",
            "Jun '25",
            "Jul '25",
            "Aug '25",
            "Sep '25",
          ],
          wheat: [
            4100, 4200, 4350, 4500, 4650, 4800, 5000, 5100, 5300, 5500, 5700,
            5900, 6100, 6200, 6400, 6500, 6600, 6700, 6800, 6900, 6950, 7000,
            7050, 7100, 7200, 7250, 7300, 7400, 7500, 7600, 7700, 7800, 7850,
            7900, 7950, 8000,
          ],
          cotton: [
            4100, 4200, 4250, 4300, 4350, 4450, 4550, 4600, 4700, 4800, 4900,
            5000, 5100, 5150, 5200, 5300, 5450, 5550, 5650, 5750, 5800, 5850,
            5900, 5950, 6000, 6100, 6150, 6200, 6250, 6350, 6400, 6450, 6500,
            6550, 6600, 6650,
          ],
        },
      };

      const priceCtx = document.getElementById("priceChart").getContext("2d");
      let priceChart;
      function renderPriceChart(range) {
        const data = commodityData[range];
        const chartData = {
          labels: data.labels,
          datasets: [
            {
              label: "Wheat Price (INR/Quintal)",
              data: data.wheat,
              borderColor: "#ffd466",
              backgroundColor: "rgba(255, 212, 102, 0.25)",
              borderWidth: 3,
              fill: true,
              tension: 0.3,
              pointRadius: 5,
              pointHoverRadius: 7,
              pointBackgroundColor: "#ffd466",
              pointHoverBackgroundColor: "#ffd466",
              cubicInterpolationMode: "monotone",
            },
            {
              label: "Cotton Price (INR/Quintal)",
              data: data.cotton,
              borderColor: "#97c4fb",
              backgroundColor: "rgba(151, 196, 251, 0.25)",
              borderWidth: 3,
              fill: true,
              tension: 0.3,
              pointRadius: 5,
              pointHoverRadius: 7,
              pointBackgroundColor: "#97c4fb",
              pointHoverBackgroundColor: "#97c4fb",
              cubicInterpolationMode: "monotone",
            },
          ],
        };
        const chartOptions = {
          /* existing options */
        };
        if (priceChart) {
          priceChart.data = chartData;
          priceChart.options = chartOptions;
          priceChart.update();
        } else {
          priceChart = new Chart(priceCtx, {
            type: "line",
            data: chartData,
            options: chartOptions,
          });
        }
      }
      renderPriceChart("6m");
      document.querySelectorAll(".filter-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          document
            .querySelectorAll(".filter-btn")
            .forEach((b) => b.classList.remove("active"));
          btn.classList.add("active");
          renderPriceChart(btn.dataset.range);
        });
      });

      const weatherCondEl = document.getElementById("weatherCondition");
      const tempEl = document.getElementById("temperature");
      const locationEl = document.getElementById("location");
      const soilMoistureEl = document.getElementById("soilMoisture");
      const tipsEl = document.getElementById("farmingTips");
      const weatherIconEl = document.getElementById("weatherIcon");
      function setWeatherIcon(main) {
        const iconMap = {
          clear: "wb_sunny",
          clouds: "cloud",
          rain: "umbrella",
          drizzle: "grain",
          thunderstorm: "thunderstorm",
          snow: "ac_unit",
          mist: "blur_on",
          smoke: "blur_on",
          haze: "blur_on",
          fog: "blur_on",
          sand: "filter_drama",
          dust: "filter_drama",
          ash: "filter_drama",
          squall: "toys",
          tornado: "waves",
        };
        weatherIconEl.textContent = iconMap[main.toLowerCase()] || "wb_sunny";
      }
      function updateFarmingTips(temp, soilMoisture, weather) {
        let tips = [];
        if (soilMoisture < 45) {
          tips.push("Monitor soil moisture and irrigate if below 45%.");
        } else {
          tips.push("Soil moisture is adequate. Avoid over-irrigation.");
        }
        if (temp > 30) {
          tips.push(
            "High temperatures detected; ensure crops get shade or water."
          );
        } else if (temp < 15) {
          tips.push("Low temperatures; protect crops from frost if necessary.");
        }
        if (weather.includes("rain")) {
          tips.push(
            "Rain likely soon; plan fertilizer application accordingly."
          );
        } else {
          tips.push(
            "Clear skies expected; good time for pest and disease monitoring."
          );
        }
        tipsEl.innerHTML = "";
        tips.forEach((tip) => {
          const li = document.createElement("li");
          li.textContent = tip;
          tipsEl.appendChild(li);
        });
      }
      function fetchWeather(latitude, longitude) {
        const apiKey = "fd72afbbbe94c395c103da29bda8ce14"; // Replace with your API key
        const url = `https://api.openweathermap.org/data/2.5/weather?lat=${latitude}&lon=${longitude}&appid=${apiKey}&units=metric`;

        fetch(url)
          .then((response) => response.json())
          .then((data) => {
            const weatherMain = data.weather[0].main.toLowerCase();
            const weatherDesc = data.weather[0].description;
            const temp = Math.round(data.main.temp);
            const name = data.name;
            weatherCondEl.textContent =
              weatherDesc.charAt(0).toUpperCase() + weatherDesc.slice(1);
            tempEl.textContent = `${temp}°C`;
            locationEl.textContent = name;
            setWeatherIcon(weatherMain);
            const simulatedSoilMoisture = Math.floor(Math.random() * 25) + 40;
            soilMoistureEl.textContent = `Soil Moisture: ${simulatedSoilMoisture}%`;

            updateFarmingTips(temp, simulatedSoilMoisture, weatherMain);
          })
          .catch(() => {
            weatherCondEl.textContent = "Unable to fetch weather data";
            tempEl.textContent = "";
            locationEl.textContent = "";
            soilMoistureEl.textContent = "";
            tipsEl.innerHTML =
              "<li>Please check your internet connection.</li>";
            weatherIconEl.textContent = "error";
          });
      }
      function initWeather() {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            (position) => {
              fetchWeather(position.coords.latitude, position.coords.longitude);
            },
            () => {
              weatherCondEl.textContent = "Location access denied";
              tipsEl.innerHTML =
                "<li>Enable location to show local weather and farming tips.</li>";
              weatherIconEl.textContent = "location_off";
            }
          );
        } else {
          weatherCondEl.textContent = "Geolocation not supported";
          tipsEl.innerHTML =
            "<li>Your browser does not support geolocation.</li>";
          weatherIconEl.textContent = "error";
        }
      }
      initWeather();
    </script>
  </body>
</html>
