<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Simple Chatbot</title>
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Jost:ital,wght@0,100..900;1,100..900&family=Outfit:wght@100..900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Quicksand:wght@300..700&display=swap"
      rel="stylesheet"
    />

    <style>
      /* ================== RESET & BODY ================== */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Poppins", sans-serif;
      }

      body {
        height: 100vh;
        background: #ebf2f8;
        color: #333;
        display: flex;
        flex-direction: column;
        overflow: hidden; /* Prevent full page scroll */
      }

      /* ================== HEADER ================== */
      header nav {
        position: sticky;
        top: 0;
        z-index: 1000;
        background: #fdfdfd;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 15px 20px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      }

      .logo a {
        text-decoration: none;
        font-weight: bold;
        font-size: 20px;
        color: #2b7a3d;
      }

      /* ================== LAYOUT ================== */
      .layout {
        flex: 1;
        display: flex;
        position: relative;
        height: calc(100vh - 60px);
        overflow: hidden; /* Prevent page scroll */
      }

      /* ================== SIDEBAR ================== */
      .sidebar {
        width: 240px;
        background: #dbe4e9;
        box-shadow: 2px 0 5px rgba(0, 0, 0, 0.05);
        padding: 20px 0;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        position: sticky;
        top: 0;
        height: 100vh; /* Make sidebar full height */
      }

      .sidebar-nav {
        list-style: none;
        margin-top: 20px;
      }

      .sidebar-nav li {
        margin: 10px 0;
      }

      .sidebar-nav a {
        text-decoration: none;
        color: #373f4c;
        padding: 12px 20px;
        display: flex;
        align-items: center;
        border-radius: 6px;
        transition: all 0.1s;
        gap: 10px;
      }

      .sidebar-nav a:hover {
        background: #2472cc;
        color: #fff;
      }

      .sidebar-nav a.active {
        background: #2472cc;
        color: #fff;
      }

      /* ================== CHAT CONTAINER ================== */
      .chat-container {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center; /* Center chat in available space */
        height: 100%;
        overflow: hidden;
      }

      .chat-container > div {
        width: 500px;
        background: #fff;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-direction: column;
        overflow: hidden;
        height: 500px; /* Fixed height for scroll area */
      }

      #chat-box {
        flex: 1;
        padding: 15px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 10px;
        scroll-behavior: smooth;
      }

      .message {
        max-width: 80%;
        padding: 10px 15px;
        border-radius: 20px;
        word-wrap: break-word;
        line-height: 1.5;
      }

      .user {
        align-self: flex-end;
        background: #1a73e8;
        color: #fff;
        border-bottom-right-radius: 0;
      }

      .bot {
        align-self: flex-start;
        background: #e0f7e9;
        color: #0f9d58;
        border-bottom-left-radius: 0;
      }

      .input-area {
        display: flex;
        border-top: 1px solid #ddd;
      }

      #message {
        flex: 1;
        border: none;
        padding: 10px;
        font-size: 16px;
      }

      #message:focus {
        outline: none;
      }

      #send-btn {
        padding: 0 20px;
        background: #1a73e8;
        border: none;
        color: white;
        font-weight: bold;
        cursor: pointer;
      }

      #send-btn:hover {
        background: #155cb0;
      }

      /* ================== SCROLLBAR STYLE ================== */
      #chat-box::-webkit-scrollbar {
        width: 6px;
      }

      #chat-box::-webkit-scrollbar-thumb {
        background-color: rgba(0, 0, 0, 0.2);
        border-radius: 3px;
      }
    </style>
  </head>

  <body>
    <!-- HEADER -->
    <header>
      <nav>
        <div class="logo"><a href="#">AgriNav</a></div>
      </nav>
    </header>

    <!-- LAYOUT: SIDEBAR + MAIN -->
    <div class="layout">
      <!-- SIDEBAR -->
      <aside class="sidebar">
        <ul class="sidebar-nav">
          <li>
            <a href="http://localhost:8000"
              ><span class="material-symbols-outlined">dashboard</span
              >Dashboard</a
            >
          </li>
          <li>
            <a href="http://localhost:8000"
              ><span class="material-symbols-outlined">smart_toy</span
              >Chatbot</a
            >
          </li>
          <li>
            <a href="http://localhost:8000/marketPrice"
              ><span class="material-symbols-outlined">shopping_cart</span
              >Market Price</a
            >
          </li>
          <li>
            <a href="#"
              ><span class="material-symbols-outlined">pest_control</span>Pest
              Detection</a
            >
          </li>
          <li>
            <a href="http://localhost:8000/weather"
              ><span class="material-symbols-outlined">groups</span>Weather</a
            >
          </li>
          <li>
            <a href="http://localhost:8000/articles"
              ><span class="material-symbols-outlined">article</span>Articles</a
            >
          </li>
        </ul>
      </aside>

      <!-- CHAT CONTAINER -->
      <div class="chat-container">
        <div>
          <div id="chat-box"></div>
          <div class="input-area">
            <input
              type="text"
              id="message"
              placeholder="Type your message..."
            />
            <button id="send-btn" onclick="sendMessage()">Send</button>
          </div>
        </div>
      </div>
    </div>

    <script>
      function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== "") {
          const cookies = document.cookie.split(";");
          for (let cookie of cookies) {
            cookie = cookie.trim();
            if (cookie.startsWith(name + "=")) {
              cookieValue = decodeURIComponent(
                cookie.substring(name.length + 1)
              );
              break;
            }
          }
        }
        return cookieValue;
      }

      async function sendMessage() {
        const msgInput = document.getElementById("message");
        const msg = msgInput.value.trim();
        if (!msg) return;

        const chatBox = document.getElementById("chat-box");

        const userDiv = document.createElement("div");
        userDiv.className = "message user";
        userDiv.innerHTML = `<b>You:</b> ${msg}`;
        chatBox.appendChild(userDiv);
        chatBox.scrollTop = chatBox.scrollHeight;

        msgInput.value = "";

        const botDiv = document.createElement("div");
        botDiv.className = "message bot";
        botDiv.innerHTML = `<i>Bot is typing...</i>`;
        chatBox.appendChild(botDiv);
        chatBox.scrollTop = chatBox.scrollHeight;

        try {
          const resp = await fetch("/chat/", {
            method: "POST",
            headers: {
              "X-CSRFToken": getCookie("csrftoken"),
              "Content-Type": "application/x-www-form-urlencoded",
            },
            body: new URLSearchParams({ message: msg }),
          });

          const data = await resp.json();
          botDiv.innerHTML = `<b>Agrinav : </b> ${data.reply || "Error"}`;
          chatBox.scrollTop = chatBox.scrollHeight;
        } catch (err) {
          botDiv.innerHTML = `<b>Agrinav:</b> Error connecting to server.`;
        }
      }

      document
        .getElementById("message")
        .addEventListener("keypress", function (e) {
          if (e.key === "Enter") sendMessage();
        });
    </script>
  </body>
</html>
